
> stratamind-agent@0.0.0 test:coverage
> vitest --coverage


[1m[44m DEV [49m[22m [34mv4.0.16 [39m[90m/Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent[39m
      [2mCoverage enabled with [22m[33mv8[39m

 [32mâœ“[39m src/components/__tests__/ChatPanel.test.tsx [2m([22m[2m36 tests[22m[2m)[22m[33m 895[2mms[22m[39m
 [32mâœ“[39m src/__tests__/integration/App.advanced.test.tsx [2m([22m[2m10 tests[22m[2m)[22m[33m 752[2mms[22m[39m
 [32mâœ“[39m src/components/__tests__/PortfolioVisualizer.reallocation.test.tsx [2m([22m[2m5 tests[22m[2m)[22m[33m 1607[2mms[22m[39m
       [33m[2mâœ“[22m[39m should show warning when new allocation would exceed 100% [33m 399[2mms[22m[39m
       [33m[2mâœ“[22m[39m should show proportional rebalance button when over 100% [33m 310[2mms[22m[39m
       [33m[2mâœ“[22m[39m should calculate proportional rebalance correctly [33m 343[2mms[22m[39m
       [33m[2mâœ“[22m[39m should submit with rebalanced allocations when confirmed [33m 335[2mms[22m[39m
[90mstdout[2m | src/__tests__/integration/App.coverage.test.tsx[2m > [22m[2mApp Coverage Boosters - Additional Tests[2m > [22m[2mChat Interaction[2m > [22m[2mshould handle chat input and send message
[22m[39mDEBUG: Received AI Result Keys: [ [32m'response'[39m ]

 [32mâœ“[39m src/__tests__/integration/App.coverage.test.tsx [2m([22m[2m3 tests[22m[2m)[22m[33m 585[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle chat input and send message [33m 313[2mms[22m[39m
 [32mâœ“[39m src/components/__tests__/TickerSearch.test.tsx [2m([22m[2m5 tests[22m[2m)[22m[33m 799[2mms[22m[39m
     [33m[2mâœ“[22m[39m should trigger search on input change [33m 312[2mms[22m[39m
     [33m[2mâœ“[22m[39m should call onChange when result is clicked [33m 332[2mms[22m[39m
[90mstdout[2m | src/__tests__/integration/app.integration.test.tsx[2m > [22m[2mIntegration Tests - Complete User Workflows[2m > [22m[2mChat Interaction Workflow[2m > [22m[2mshould send a message to the AI
[22m[39mDEBUG: Received AI Result Keys: [ [32m'response'[39m ]

[90mstderr[2m | src/__tests__/integration/AI_FlatPortfolio.integration.test.tsx[2m > [22m[2mAI Flat Portfolio Integration[2m > [22m[2mshould create a flat portfolio structure when AI uses holdings parameter
[22m[39mFailed to load performance data, using mock data TypeError: history.map is not a function
    at loadPerformance [90m(/Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mApp.tsx:223:46[90m)[39m

 [32mâœ“[39m src/components/__tests__/PortfolioVisualizer.test.tsx [2m([22m[2m47 tests[22m[2m)[22m[33m 3600[2mms[22m[39m
       [33m[2mâœ“[22m[39m should call onAddSlice when form is submitted [33m 579[2mms[22m[39m
         [33m[2mâœ“[22m[39m should validate ticker symbol before adding holding [33m 494[2mms[22m[39m
[90mstdout[2m | src/__tests__/integration/AI_FlatPortfolio.integration.test.tsx[2m > [22m[2mAI Flat Portfolio Integration[2m > [22m[2mshould create a flat portfolio structure when AI uses holdings parameter
[22m[39mDEBUG: Received AI Result Keys: [ [32m'text'[39m, [32m'functionCalls'[39m ]

[90mstderr[2m | src/__tests__/integration/app.integration.test.tsx[2m > [22m[2mIntegration Tests - Complete User Workflows[2m > [22m[2mError Handling Workflow[2m > [22m[2mshould handle corrupted localStorage data
[22m[39mFailed to init data SyntaxError: Unexpected token 'i', "invalid json{" is not valid JSON
    at JSON.parse (<anonymous>)
    at load [90m(/Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39msrc/__tests__/integration/app.integration.test.tsx:31:30[90m)[39m
    at Object.<anonymous> [90m(/Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39msrc/__tests__/integration/app.integration.test.tsx:39:37[90m)[39m
    at Object.Mock [90m(file:///Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mnode_modules/[4m@vitest[24m/spy/dist/index.js:285:34[90m)[39m
    at initData [90m(/Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mApp.tsx:160:41[90m)[39m
    at [90m/Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mApp.tsx:203:9
    at Object.react_stack_bottom_frame [90m(/Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mnode_modules/[4mreact-dom[24m/cjs/react-dom-client.development.js:25989:20[90m)[39m
    at runWithFiberInDEV [90m(/Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mnode_modules/[4mreact-dom[24m/cjs/react-dom-client.development.js:874:13[90m)[39m
    at commitHookEffectListMount [90m(/Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mnode_modules/[4mreact-dom[24m/cjs/react-dom-client.development.js:13249:29[90m)[39m
    at commitHookPassiveMountEffects [90m(/Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mnode_modules/[4mreact-dom[24m/cjs/react-dom-client.development.js:13336:11[90m)[39m

[90mstderr[2m | src/__tests__/integration/AI_FlatPortfolio.integration.test.tsx[2m > [22m[2mAI Flat Portfolio Integration[2m > [22m[2mshould create a flat portfolio structure when AI uses holdings parameter
[22m[39mFailed to record snapshot TypeError: newHistory.map is not a function
    at updateActiveAccount [90m(/Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mApp.tsx:872:43[90m)[39m
    at createNewStrategy [90m(/Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mApp.tsx:1071:9[90m)[39m

 [32mâœ“[39m src/__tests__/integration/AI_FlatPortfolio.integration.test.tsx [2m([22m[2m1 test[22m[2m)[22m[33m 676[2mms[22m[39m
     [33m[2mâœ“[22m[39m should create a flat portfolio structure when AI uses holdings parameter [33m 675[2mms[22m[39m
 [32mâœ“[39m src/__tests__/integration/app.integration.test.tsx [2m([22m[2m16 tests[22m[2m)[22m[33m 4265[2mms[22m[39m
       [33m[2mâœ“[22m[39m should rebalance existing slices when adding a new one that exceeds 100% [33m 829[2mms[22m[39m
       [33m[2mâœ“[22m[39m should add a slice to the portfolio [33m 685[2mms[22m[39m
       [33m[2mâœ“[22m[39m should update or move existing ticker instead of creating duplicate [33m 605[2mms[22m[39m
       [33m[2mâœ“[22m[39m should complete a full portfolio creation workflow [33m 497[2mms[22m[39m
 [32mâœ“[39m src/components/__tests__/AccountSettingsModal.test.tsx [2m([22m[2m8 tests[22m[2m)[22m[33m 488[2mms[22m[39m
 [32mâœ“[39m src/__tests__/integration/App.layout.test.tsx [2m([22m[2m5 tests[22m[2m)[22m[32m 288[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/PerformanceComponents.test.tsx [2m([22m[2m6 tests[22m[2m)[22m[32m 57[2mms[22m[39m
[90mstderr[2m | src/services/__tests__/marketData.test.ts[2m > [22m[2mmarketData service[2m > [22m[2msearchSymbols[2m > [22m[2mshould handle API errors gracefully
[22m[39mFailed to search symbols: Error: Network error
    at [90m/Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39msrc/services/__tests__/marketData.test.ts:291:57
    at [90mfile:///Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:145:11
    at [90mfile:///Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:915:26
    at [90mfile:///Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1209:10[90m)[39m
    at [90mfile:///Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1653:37
    at Traces.$ [90m(file:///Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m src/utils/__tests__/rebalanceHelpers.test.ts [2m([22m[2m18 tests[22m[2m)[22m[32m 10[2mms[22m[39m
 [32mâœ“[39m src/services/__tests__/marketData.test.ts [2m([22m[2m21 tests[22m[2m)[22m[32m 12[2mms[22m[39m
[90mstderr[2m | src/components/__tests__/PerformanceChart.mobile.test.tsx[2m > [22m[2mPerformanceChart - Mobile Behavior[2m > [22m[2mshould handle window resize events
[22m[39mThe tag <stop> is unrecognized in this browser. If you meant to render a React component, start its name with an uppercase letter.
<linearGradient /> is using incorrect casing. Use PascalCase for React components, or lowercase for HTML elements.
The tag <linearGradient> is unrecognized in this browser. If you meant to render a React component, start its name with an uppercase letter.
The tag <defs> is unrecognized in this browser. If you meant to render a React component, start its name with an uppercase letter.

[90mstderr[2m | src/components/__tests__/PerformanceChart.mobile.test.tsx[2m > [22m[2mPerformanceChart - Mobile Behavior[2m > [22m[2mshould render when not loading
[22m[39m<linearGradient /> is using incorrect casing. Use PascalCase for React components, or lowercase for HTML elements.

 [32mâœ“[39m src/components/__tests__/PerformanceChart.mobile.test.tsx [2m([22m[2m3 tests[22m[2m)[22m[32m 57[2mms[22m[39m
 [32mâœ“[39m src/services/__tests__/database.crud.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 8[2mms[22m[39m
[90mstderr[2m | src/services/__tests__/database.error.test.ts[2m > [22m[2mDatabase Service - Error Handling[2m > [22m[2mshould handle API network failure in load()
[22m[39mFailed to load DB from API Error: Network Error
    at [90m/Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39msrc/services/__tests__/database.error.test.ts:11:50
    at [90mfile:///Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:145:11
    at [90mfile:///Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:915:26
    at [90mfile:///Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1209:10[90m)[39m
    at [90mfile:///Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1653:37
    at Traces.$ [90m(file:///Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | src/services/__tests__/database.error.test.ts[2m > [22m[2mDatabase Service - Error Handling[2m > [22m[2mshould handle HTTP error in load()
[22m[39mFailed to load DB from API Error: Server Internal Error
    at handleResponse [90m(/Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mservices/database.ts:10:15[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Object.load [90m(/Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mservices/database.ts:23:26[90m)[39m
    at [90m/Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39msrc/services/__tests__/database.error.test.ts:24:24
    at [90mfile:///Users/soliv112/PersonalProjects/StrataMind/portfolio-ai/stratamind-agent/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:915:20

 [32mâœ“[39m src/services/__tests__/database.error.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 8[2mms[22m[39m
[90mstderr[2m | src/services/__tests__/database.test.ts[2m > [22m[2mDatabase Service - Renaming[2m > [22m[2mshould update institution name
[22m[39mBulk Save not implemented in API Mode - use granular updates

[90mstderr[2m | src/services/__tests__/database.test.ts[2m > [22m[2mDatabase Service - Renaming[2m > [22m[2mshould update account name
[22m[39mBulk Save not implemented in API Mode - use granular updates

 [32mâœ“[39m src/services/__tests__/performanceService.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 4[2mms[22m[39m
 [32mâœ“[39m src/services/__tests__/database.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m src/utils/__tests__/portfolioTree.test.ts [2m([22m[2m24 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m src/services/__tests__/portfolioFactory.nestedGroups.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 4[2mms[22m[39m
[90mstderr[2m | src/services/__tests__/geminiService.mock.test.ts
[22m[39mâš ï¸ Gemin API Key is missing! Check your .env file for GEMINI_API_KEY or VITE_GEMINI_API_KEY.

[90mstderr[2m | src/services/__tests__/geminiService.mock.test.ts[2m > [22m[2mGemini Service - Mocked[2m > [22m[2mshould create a chat session with correct configuration
[22m[39mGemini API Key missing - Chat disabled.

[90mstderr[2m | src/services/__tests__/geminiService.mock.test.ts[2m > [22m[2mGemini Service - Mocked[2m > [22m[2mshould handle missing API key gracefully
[22m[39mGemini API Key missing - Chat disabled.

[90mstderr[2m | src/services/__tests__/geminiService.mock.test.ts[2m > [22m[2mGemini Service - Mocked[2m > [22m[2mshould return mock response when API key is missing
[22m[39mGemini API Key missing - Chat disabled.

 [32mâœ“[39m src/services/__tests__/geminiService.mock.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 4[2mms[22m[39m
 [32mâœ“[39m src/services/__tests__/benchmarkOverlay.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 3[2mms[22m[39m
 [32mâœ“[39m src/services/__tests__/integration.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 3[2mms[22m[39m
 [32mâœ“[39m src/services/__tests__/strategyVerification.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 3[2mms[22m[39m
 [32mâœ“[39m src/services/__tests__/portfolioCreation.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 3[2mms[22m[39m
 [32mâœ“[39m src/services/__tests__/geminiService.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 2[2mms[22m[39m

[2m Test Files [22m [1m[32m26 passed[39m[22m[90m (26)[39m
[2m      Tests [22m [1m[32m255 passed[39m[22m[90m (255)[39m
[2m   Start at [22m 21:03:29
[2m   Duration [22m 10.06s[2m (transform 1.18s, setup 6.22s, import 3.85s, tests 14.14s, environment 18.54s)[22m

[34m % [39m[2mCoverage report from [22m[33mv8[39m
-------------------|---------|----------|---------|---------|-------------------
File               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
-------------------|---------|----------|---------|---------|-------------------
All files          |   72.04 |     66.7 |      75 |   74.37 |                   
 stratamind-agent  |   56.99 |    53.29 |   55.46 |   60.24 |                   
  App.tsx          |   56.29 |    52.77 |   54.76 |   59.67 | ...1469,1530-1555 
  types.ts         |     100 |      100 |     100 |     100 |                   
 ...ent/components |   81.95 |    77.55 |      85 |   84.03 |                   
  ...ingsModal.tsx |   96.96 |    96.96 |     100 |     100 | 41                
  ChatPanel.tsx    |     100 |    96.15 |     100 |     100 | 26                
  ...anceChart.tsx |   61.36 |    52.63 |   53.33 |      65 | ...67,108,174-178 
  ...anceStats.tsx |     100 |    66.66 |     100 |     100 | 19-25             
  ...isualizer.tsx |   79.79 |    78.57 |   82.97 |   82.18 | ...58,390-432,486 
  TickerSearch.tsx |      90 |    88.88 |     100 |   89.47 | 44-45,50-51       
 ...agent/services |      80 |    70.43 |   91.48 |   81.22 |                   
  database.ts      |   95.16 |       80 |   95.23 |   94.64 | 16,55,151         
  geminiService.ts |   93.33 |    84.61 |     100 |   92.85 | 12,196            
  marketData.ts    |      60 |    56.71 |   66.66 |   62.76 | ...86,223,230-264 
  ...lioFactory.ts |   97.36 |       96 |     100 |     100 | 10                
 ...t/src/services |    93.1 |    66.66 |     100 |     100 |                   
  ...nceService.ts |    93.1 |    66.66 |     100 |     100 | 57-71             
 ...nd-agent/utils |     100 |       92 |     100 |     100 |                   
  portfolioTree.ts |     100 |       90 |     100 |     100 | 66,82-84,107      
  ...nceHelpers.ts |     100 |      100 |     100 |     100 |                   
-------------------|---------|----------|---------|---------|-------------------
[1m[42m PASS [49m[22m [32mWaiting for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
